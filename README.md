# phrase-eater
monster that eats phrases and grows (Google Apps Script, SpreadsheetApp, Telegram Bot)
## идея бота
монстр, который ест фразы и растет
## примерный план по версиям
1. на всё отвечает одинаково + ведёт лог
2. проверять ид пользователя: если это я, то идти дальше по скрипту; если незнакомец (есть в таблице незнакомцев), то не отвечать; если неопределён, то сказать "извините, я с незнакомцами не разговариваю" и добавить в таблицу незнакомцев
3. уведомление в настроенное время: приветствие
4. табличка с текущим состоянием; в приветствии выводить инфу о состоянии (возможно, с эмоджи)
```
а) уровень (сейчас: 0, максимум: 3)
б) сытость (сейчас: 0, максимум: 3, новый максимум: 0)
в) опыт (сейчас: 0, максимум: 3, новый максимум: 0)
г) фраз в памяти (сейчас: 0)
```
5. новое входящее сообщение
```
а) если сытость = максимуму, то не отвечать
б) если сытость < максимума, то записать фразу в память, сытость+1, ответить отчётом о сытости и памяти, а если сытость стала максимальной, то попрощаться до завтра и добавить, что монстрик ушёл спать
```
6. добавлять к приветствию рандомную фразу из памяти: "одна из чудесных фраз, которые я съел, звучала так"
7. перед приветствием проверить вчерашний день + обнуление сытость
```
а) если сытость = максимум, то:
  аа) если опыт < максимума, то опыт+1
  аб) если опыт = максимум, то:
   аба) если уровень < максимума, то левел-ап: уровень+1, опыт=0
   абб) если уровень = максимуму, то ничего не происходит
 б) если сытость < максимума, то:
  ба) если память не пустая, то удалить случайную фразу из памяти, в приветствии добавить, что одна из съеденных фраз была забыта
  бб) если память пустая, то обнулить опыт и уровень, в приветствии сказать о том, что монстрик забыл обо всех съеденных фразах и уменьшился до начальных размеров
```
8. снять максимум с уровня; добавить при левел-апе: предложить повысить максимум сытости или опыта, повысить выбранное, записать результат в новый максимум; при сравнении сытости или опыта с максимумами брать тот, который выше (максимум или новый максимум); добавить при обнулении: обнулять новые максимумы
9. проверка уникальности фразы, если такая уже в памяти есть, то монстрик откажется её съесть
## мини-инструкция для повторения
1) создать таблицу в гугло-доке
2) добавить в неё страницы (текущие состояния, память, незнакомцы, лог)
3) открыть редактор скриптов (Инструменты - Редактор скриптов)
4) создать там файлы и скопировать-вставить их код
5) зарегистрировать бота у @BotFather и получить его апи-ключ
6) добавить свойство скрипта apikey и указать там полученный апи-ключ
7) развернуть как веб-приложение с доступом для всех (включая анонимных)
8) после успешной развёртки (у скрипта появится адрес) запустить функцию setWebhook
9) настроить бота у @BotFather (можно указать инфо и описание, добавить картинку и команды)
## источники вдохновения и кода
* [oshlibot](https://gist.github.com/oshliaer/77ccc68599e7b0fea39f)
* [gas-telegram-bot](https://github.com/ocordova/gas-telegram-bot)
* [Telegram-bot-dlya-google-tablicy](https://telegra.ph/Telegram-bot-dlya-google-tablicy-04-17) (если телеграф недоступен, то пдф страницы вот: [drive.google.com/file](https://drive.google.com/file/d/1rKvdttNaFMBpWwyKWc0SYvyN5QvcnPoF/view?usp=sharing))
